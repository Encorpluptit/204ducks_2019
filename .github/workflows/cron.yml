name: "Synchronise Blih"

on:
  push:
#  schedule:
#    - cron: "*/5 * * * *"

jobs:
  blih:

    runs-on: ubuntu-latest
    env:
      USER_GHUB: "Encorpluptit"
      USER_BLIH: "damien.bernard@epitech.eu"
    steps:
      - uses: actions/checkout@v2
#       - uses: webfactory/ssh-agent@v0.2.0
#         with:
#           ssh-public-key: ${{ secrets.SSH_PUBLIC_KEY }}
#           ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
#       - run: |
#           mkdir ~/.ssh
#           echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
#           chmod 600 ~/.ssh/id_rsa
#           ssh-keyscan -t rsa git.epitech.eu
      - run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" | tr -d '\r' | ssh-add -
          mkdir -p ~/.ssh
          chmod 700 ~/.ssh
          echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config
      - name: Set Github Repo Name in env
        run:   echo ::set-env name=REPOSITORY_NAME::$(echo "$GITHUB_REPOSITORY" | awk -F / '{print $2}' | sed -e "s/:refs//")
        shell: bash
#       - name: test_env
#         env:
#           USER_GHUB: "Encorpluptit"
#           USER_BLIH: "damien.bernard@epitech.eu"
#         run: |
#           echo "$USER_GHUB"
#           echo "$USER_BLIH"
#           echo "$REPOSITORY_NAME"
#         shell: bash
      - name: Push Blih
#         env:
#           USER_GHUB: "Encorpluptit"
#           USER_BLIH: "damien.bernard@epitech.eu"
        run: bash ./.github/workflows/GithubToBlih.sh $REPOSITORY_NAME
        shell: bash


  docker_test:
    runs-on: ubuntu-latest
    name: A job to say hello
    steps:
      # To use this repository's private action, you must check out the repository
      - name: Checkout
        uses: actions/checkout@v2
#       - name: lol
#         uses: docker run epitechcontent/epitest-docker
      - name: Hello world action step
        uses: ./.github/docker # Uses an action in the .github/docker directory
        #uses: ./ # Uses an action in the root directory
        id: hello
        with:
          who-to-greet: 'Mona the Octocat'
      # Use the output from the `hello` step
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"
#
#  blih2:
#    runs-on: ubuntu-latest
#
#    steps:
#    - uses: actions/204ducks_2019
#    - name: test_env
#      env:
#        USER_GHUB: "Encorpluptit"
#        USER_BLIH: "damien.bernard@epitech.eu"
#      run: |
#        echo "$USER_GHUB"
#        echo "$USER_BLIH"
#        echo "$REPOSITORY_NAME"
#      shell: bash

